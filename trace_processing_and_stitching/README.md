# Gates of Time Trace Processing and Stitching README

## Step 1: Convert Prime+Store Traces to Square and Multiply Traces
Convert Prime+Store traces to square and multiply traces by issuing the command 

`./sigproc < <INPUT_FILE>`

 Input file is the traces generated by the Prime+Store attack. You can pipe the result to a file for further processing in the next stage.

`./sigproc < <INPUT_FILE> > <OUTPUT_FILE>`

This stores the resulting square and multiply traces to OUTPUT_FILE.

To assist with the evaluation of this artifact, we offer sample data that can offer more comprehensive guidance. The sample data for this particular experiment can be found in the directory labeled `DATASETS/prime_store_el_gamal_trace.txt`. This file contains the raw data obtained from our execution of the Prime+Store attack.

To run the `sigproc` program with this sample input, run the following

`
	./sigproc < DATASETS/prime_store_el_gamal_trace.txt > SIGPROC_OUTPUT.txt
`


## Step 2: Stitching Square and Multiply Traces to Recover the Full Sequence
To recover the entire Square and Multiply sequence from partial traces in the output file of the `sigproc` program, the stitching algorithm is used. Two versions of the algorithm are available: `stitch_parallel_simd_any_pos`, which expands the sequence in both forward and backward directions, and `stitch_parallel_simd` which only expands the key in the forward direction. Both algorithms are useful for recovering the full sequence, but the former is better for finding a solid initial chunk, while the latter is more efficient for expanding the key to completeness. This is because the former is slower and may cause unnecessary collisions before the beginning of the key, after the actual starting trace has been found.

To use these programs run the following commands:

`
	./stitch_parallel_simd_any_pos <INPUT_FILE_FROM_SIGPROC> <INITIAL_TRACE_TO_EXPAND_FROM>
`

To run the version that expands in both directions. 

`
	./stitch_parallel_simd <INPUT_FILE_FROM_SIGPROC> <INITIAL_TRACE_TO_EXPAND_FROM>
`
To run the version that expands only in forward direction.

The `INPUT_FILE_FROM_SIGPROC` parameter is the output file from `sigproc`, while the `INITIAL_TRACE_TO_EXPAND_FROM` is the string of the trace that is considered a good starting point for key expansion. For example

`
	./stitch_parallel_simd SIGPROC_OUTPUT.txt SSSmSmSmSmSSSmSSSmSSSmSSSSSSm
`

and

`
	./stitch_parallel_simd_any_pos SIGPROC_OUTPUT.txt SSSmSmSmSmSSSmSSSmSSSmSSSSSSm
`

To find the starting point, the `find_start_sequences` tool can be used to list the traces in order of occurrence frequency, from highest to lowest. It is recommended to choose a string that appears frequently in the `sigproc` output, as this indicates that the trace is a reliable reading and actually appears in the original key.

For example, running the following
`
	./find_start_sequences SIGPROC_OUTPUT.txt
`

Returns the sequence: "SSSmSmSmSmSSSmSSSmSSSmSSSSSSm" with 15 matches. This is a good indication that this sequence is reliable, and appears in the original key (as a matter of fact, it does!).

## Step 3: Convert the Stitched Square and Multiply Sequence to Binary

Now the last step is to convert the expanded square and multiply sequences to its binary form, which is the recovered key from the Prime+Store attack. To do this, run the following command.


`
	./sm_to_exponent <SQUARE_AND_MULTIPLY_STRING>
`

For example,

`
	./sm_to_exponent ``SSmSmSmSSSSmSmSS''
`

This returns the binary "01110001100". This is the recovered ElGamal key.

The factual ElGamal key, also referred to as the "ground truth," can be found in the directory titled `DATASETS/GROUND_TRUTH.txt`. This file contains information regarding the hexadecimal, binary, as well as the square and multiply representations of the key.